# Documentación de la API

## Descripción General

La API REST de ANB Rising Stars Showcase está construida con FastAPI y proporciona endpoints para la gestión de usuarios, videos y votaciones. La API implementa autenticación JWT y documentación automática interactiva.

## Acceso a la Documentación

### Documentación Interactiva (Swagger UI)
```
http://localhost:8000/docs
```
Interfaz interactiva que permite:
- Ver todos los endpoints disponibles
- Probar requests directamente desde el navegador
- Ver esquemas de request/response
- Autenticarse con JWT tokens

### Documentación Alternativa (ReDoc)
```
http://localhost:8000/redoc
```
Documentación en formato ReDoc, más orientada a lectura.

## Endpoints Disponibles

### Autenticación
| Método | Endpoint | Descripción | Auth |
|--------|----------|-------------|------|
| `POST` | `/api/auth/signup` | Registro de nuevo usuario | No |
| `POST` | `/api/auth/login` | Autenticación y obtención de JWT | No |

### Gestión de Videos (Privado)
| Método | Endpoint | Descripción | Auth |
|--------|----------|-------------|------|
| `POST` | `/api/videos/upload` | Subir video para procesamiento | Sí |
| `GET` | `/api/videos` | Listar videos propios | Sí |
| `GET` | `/api/videos/{video_id}` | Obtener detalles de video propio | Sí |
| `DELETE` | `/api/videos/{video_id}` | Eliminar video propio | Sí |

### Videos Públicos y Votación
| Método | Endpoint | Descripción | Auth |
|--------|----------|-------------|------|
| `GET` | `/api/public/videos` | Listar videos públicos procesados | No |
| `POST` | `/api/public/videos/{video_id}/vote` | Votar por un video | Sí |
| `GET` | `/api/public/rankings` | Obtener ranking de jugadores | No |

### Monitoreo
| Método | Endpoint | Descripción | Auth |
|--------|----------|-------------|------|
| `GET` | `/health` | Health check de la aplicación | No |
| `GET` | `/` | Información básica de la API | No |

## Autenticación

La API utiliza **JWT (JSON Web Tokens)** para autenticación.

### Obtener Token
```bash
POST /api/auth/login
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "password123"
}
```

**Respuesta:**
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "Bearer",
  "expires_in": 1800
}
```

### Usar Token
```bash
GET /api/videos
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

## Ejemplos de Uso

### 1. Registro de Usuario
```bash
curl -X POST "http://localhost:8000/api/auth/signup" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "jugador@example.com",
    "first_name": "Juan",
    "last_name": "Pérez",
    "city": "Bogotá",
    "country": "Colombia",
    "password1": "securepass123",
    "password2": "securepass123"
  }'
```

### 2. Upload de Video
```bash
curl -X POST "http://localhost:8000/api/videos/upload" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "title=Mi mejor jugada" \
  -F "video_file=@video.mp4"
```

### 3. Votar por Video
```bash
curl -X POST "http://localhost:8000/api/public/videos/{video_id}/vote" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### 4. Consultar Rankings
```bash
curl -X GET "http://localhost:8000/api/public/rankings?city=Bogotá&limit=10"
```

## Pruebas con Postman

### Colección de Postman

El proyecto incluye una colección completa de Postman con todos los endpoints y pruebas automatizadas.

**Ubicación:** `collections/anb-api.postman_collection.json`

### Importar Colección

1. Abrir Postman
2. Click en **Import**
3. Seleccionar los archivos:
   - `collections/anb-api.postman_collection.json`
   - `collections/postman_environment.json`
4. Seleccionar el environment "ANB API Environment"

### Configurar Variables de Entorno

```json
{
  "base_url": "http://localhost:8000",
  "access_token": "<se actualiza automáticamente al hacer login>"
}
```

### Ejecutar Pruebas

#### Opción 1: Desde Postman
1. Seleccionar la colección "ANB Rising Stars Showcase API"
2. Click en **Run** (botón azul)
3. Seleccionar todos los requests
4. Click en **Run ANB Rising Stars...**

#### Opción 2: Desde Línea de Comandos (Newman)

**Instalar Newman:**
```bash
npm install -g newman
```

**Ejecutar pruebas:**
```bash
newman run collections/anb-api.postman_collection.json \
  -e collections/postman_environment.json \
  --reporters cli,htmlextra \
  --reporter-htmlextra-export postman-report.html
```

### Resultado de Pruebas

La colección incluye **pruebas automatizadas** que validan:
- Códigos de estado HTTP correctos (200, 201, 400, 401, 403, 404)
- Estructura de respuestas JSON
- Presencia de campos requeridos
- Lógica de negocio (ej: no votar dos veces por el mismo video)
- Tokens JWT válidos
- Relaciones entre entidades

## Esquemas de Request/Response

### UserCreate (Registro)
```json
{
  "email": "string (email format)",
  "first_name": "string",
  "last_name": "string",
  "city": "string",
  "country": "string",
  "password1": "string (min 8 chars)",
  "password2": "string (must match password1)"
}
```

### VideoUploadResponse
```json
{
  "message": "Video subido correctamente. Procesamiento en curso.",
  "task_id": "uuid-celery-task-id"
}
```

### VideoListResponse
```json
{
  "video_id": "uuid",
  "title": "string",
  "status": "uploaded | processing | processed | failed",
  "uploaded_at": "2024-01-01T00:00:00",
  "processed_at": "2024-01-01T00:05:00 | null",
  "processed_url": "/api/videos/{id}/download | null"
}
```

### RankingItem
```json
{
  "position": 1,
  "username": "Juan Pérez",
  "city": "Bogotá",
  "votes": 150
}
```

## Códigos de Estado

| Código | Significado | Uso |
|--------|-------------|-----|
| `200` | OK | Request exitoso |
| `201` | Created | Recurso creado exitosamente |
| `400` | Bad Request | Datos de entrada inválidos |
| `401` | Unauthorized | Token no proporcionado o inválido |
| `403` | Forbidden | Sin permisos para el recurso |
| `404` | Not Found | Recurso no encontrado |
| `500` | Internal Server Error | Error del servidor |

## Limitaciones y Restricciones

- **Tamaño máximo de video:** 100 MB
- **Formatos soportados:** MP4, AVI, MOV, WMV, FLV, WEBM
- **Duración máxima de video procesado:** 30 segundos
- **Token JWT expira en:** 30 minutos
- **Un voto por usuario por video**
- **Solo el propietario puede eliminar sus videos**
- **Solo videos en estado "uploaded" o "failed" pueden eliminarse**

## Documentación Adicional

Para más detalles sobre cada endpoint, incluyendo:
- Parámetros de query opcionales
- Headers requeridos
- Validaciones específicas
- Casos de error detallados

Consultar la documentación interactiva en: **http://localhost:8000/docs**

---

**Guía Completa de la Colección Postman:** [collections/README.md](/collections/README.md)

